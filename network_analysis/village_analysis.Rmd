---
title: "village_analysis"
author: "Harsh Vardhan Pachisia"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Selecting villages

```{r}
library(tidyverse)
library(dplyr)
```


```{r}
load("data/DS0012/36151-0012-Data.rda")
villages <- da36151.0012
rm(da36151.0012)
```

```{r}
#selecting the columns we need
villages_sel_cols <- villages %>% 
  #select(STATEID,DISTID,STATE, DISTA, VILL, starts_with("VI16")) %>% 
   mutate(
    # Concatenate the columns, convert to numeric if needed
    village_id = as.numeric(paste0(STATE, DISTA, VILL))
    
  ) %>% 
  #keeping only distinct village ids
  distinct(village_id, .keep_all = TRUE)

length(unique(villages_sel_cols$village_id))
```

```{r}
#converting to binary
villages_sel_cols <- villages_sel_cols %>% 
 mutate_at(vars(starts_with("VI16")), ~ case_when(
    str_detect(., "1") ~ 1,   # Convert '(1) Yes 1' to 1
    str_detect(., "0") ~ 0,   # Convert '(0) No 0' to 0
    TRUE ~ NA_integer_        # Handle unexpected cases
  )) %>% 
  # Add a new column to sum all institution indicators
  mutate(total_institutions = rowSums(select(., starts_with("VI16")), na.rm = TRUE))
```


```{r}
villages_15 <- villages_sel_cols %>% 
  select(STATEID,DISTID,STATE, DISTA, VILL, village_id, total_institutions, starts_with("VI16"), starts_with("VH1"),
         starts_with("VH2"), VG16A, VG16B, VG16C, VG16D, VG17A, VG17B, VG17E, VG18A, VG18B,VG18E) %>% 
  filter(total_institutions == 15)
  
```

```{r}
# based on religious diversity (in terms of caste and religion) and number of institutions
# selecting the village in maharashtra
mah_kerala <- villages_15 %>% 
  filter(village_id == 2774 | village_id == 3281)
```

```{r}

# Rename the caste and religion variables
mah_kerala <- mah_kerala %>%
  rename(
    pct_brahmin = VH1A,
    pct_forward = VH1B,
    pct_obc = VH1C,
    pct_sc = VH1D,
    pct_st = VH1E,
    pct_others_caste = VH1F,
    pct_hindu = VH2A,
    pct_muslim = VH2B,
    pct_christian = VH2C,
    pct_sikh = VH2D,
    pct_buddhist = VH2E,
    pct_jain = VH2F,
    pct_tribal = VH2G,
    pct_others_religion = VH2H
  )
```

```{r}

# Prepare data for Caste distribution graph
mah <- mah_kerala %>% 
  filter(village_id == 2774)

caste_data_mah <- mah %>%
  rename(others = pct_others_caste) %>% 
  
  select(pct_brahmin, pct_forward, pct_obc, pct_sc, pct_st, others) %>%
  pivot_longer(cols = everything(), names_to = "caste", values_to = "percentage") %>% 
  mutate(caste = str_remove(caste, "pct_")) 

# Plotting caste distribution
ggplot(caste_data_mah, aes(x = caste, y = percentage, fill = caste)) +
  geom_bar(stat = "identity") +
  labs(title = "Caste Distribution in the Maharashtrian Village", x = "Caste Category", y = "Percentage of Population") +
  scale_fill_brewer(palette = "Pastel2") +  # Optional: improves color distinction
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 1))

# Prepare data for Caste distribution graph
ker <- mah_kerala %>% 
  filter(village_id == 3281)

caste_data_ker <- ker %>%
  rename(others = pct_others_caste) %>% 
  select(pct_brahmin, pct_forward, pct_obc, pct_sc, pct_st, others) %>%
  pivot_longer(cols = everything(), names_to = "caste", values_to = "percentage") %>% 
  mutate(caste = str_remove(caste, "pct_")) 

# Plotting caste distribution
ggplot(caste_data_ker, aes(x = caste, y = percentage, fill = caste)) +
  geom_bar(stat = "identity") +
  labs(title = "Caste Distribution in the Kerala Village", x = "Caste Category", y = "Percentage of Population") +
  scale_fill_brewer(palette = "Pastel2") +  # Optional: improves color distinction
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 1))
```

```{r}
# Prepare data for Religion distribution graph
religion_data_mah <- mah %>%
  rename(others = pct_others_religion) %>% 
  select(pct_hindu, pct_muslim, pct_christian, pct_sikh, pct_buddhist, pct_jain, pct_tribal, others) %>%
  pivot_longer(cols = everything(), names_to = "religion", values_to = "percentage") %>% 
  mutate(religion = str_remove(religion, "pct_")) 

# Plotting religion distribution
ggplot(religion_data_mah, aes(x = religion, y = percentage, fill = religion)) +
  geom_bar(stat = "identity") +
  labs(title = "Religion Distribution in the Maharashtrian Village", x = "Religion", y = "Percentage") +
  scale_fill_brewer(palette = "Pastel1") +  # Optional: improves color distinction
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Prepare data for Religion distribution graph
religion_data_ker <- ker %>%
  rename(others = pct_others_religion) %>% 
  select(pct_hindu, pct_muslim, pct_christian, pct_sikh, pct_buddhist, pct_jain, pct_tribal, others) %>%
  pivot_longer(cols = everything(), names_to = "religion", values_to = "percentage") %>% 
  mutate(religion = str_remove(religion, "pct_")) 

# Plotting religion distribution
ggplot(religion_data_ker, aes(x = religion, y = percentage, fill = religion)) +
  geom_bar(stat = "identity") +
  labs(title = "Religion Distribution in the Kerala Village", x = "Religion", y = "Percentage") +
  scale_fill_brewer(palette = "Pastel1") +  # Optional: improves color distinction
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

